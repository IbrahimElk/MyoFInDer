var P=Object.defineProperty;var F=(n,e,t)=>e in n?P(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>(F(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var R=Object.defineProperty,S=(n,e)=>{for(var t in e)R(n,t,{get:e[t],enumerable:!0})},O={};S(O,{convertFileSrc:()=>Y,invoke:()=>p,transformCallback:()=>C});function $(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function C(n,e=!1){let t=$(),a=`_${t}`;return Object.defineProperty(window,a,{value:s=>(e&&Reflect.deleteProperty(window,a),n==null?void 0:n(s)),writable:!1,configurable:!0}),t}async function p(n,e={}){return new Promise((t,a)=>{let s=C(o=>{t(o),Reflect.deleteProperty(window,`_${i}`)},!0),i=C(o=>{a(o),Reflect.deleteProperty(window,`_${s}`)},!0);window.__TAURI_IPC__({cmd:n,callback:s,error:i,...e})})}function Y(n,e="asset"){let t=encodeURIComponent(n);return navigator.userAgent.includes("Windows")?`https://${e}.localhost/${t}`:`${e}://localhost/${t}`}async function b(n){return p("tauri",n)}var W={};S(W,{ask:()=>X,confirm:()=>j,message:()=>B,open:()=>N,save:()=>H});async function N(n={}){return typeof n=="object"&&Object.freeze(n),b({__tauriModule:"Dialog",message:{cmd:"openDialog",options:n}})}async function H(n={}){return typeof n=="object"&&Object.freeze(n),b({__tauriModule:"Dialog",message:{cmd:"saveDialog",options:n}})}async function B(n,e){var a,s;let t=typeof e=="string"?{title:e}:e;return b({__tauriModule:"Dialog",message:{cmd:"messageDialog",message:n.toString(),title:(a=t==null?void 0:t.title)==null?void 0:a.toString(),type:t==null?void 0:t.type,buttonLabel:(s=t==null?void 0:t.okLabel)==null?void 0:s.toString()}})}async function X(n,e){var a,s,i,o,c;let t=typeof e=="string"?{title:e}:e;return b({__tauriModule:"Dialog",message:{cmd:"askDialog",message:n.toString(),title:(a=t==null?void 0:t.title)==null?void 0:a.toString(),type:t==null?void 0:t.type,buttonLabels:[(i=(s=t==null?void 0:t.okLabel)==null?void 0:s.toString())!=null?i:"Yes",(c=(o=t==null?void 0:t.cancelLabel)==null?void 0:o.toString())!=null?c:"No"]}})}async function j(n,e){var a,s,i,o,c;let t=typeof e=="string"?{title:e}:e;return b({__tauriModule:"Dialog",message:{cmd:"confirmDialog",message:n.toString(),title:(a=t==null?void 0:t.title)==null?void 0:a.toString(),type:t==null?void 0:t.type,buttonLabels:[(i=(s=t==null?void 0:t.okLabel)==null?void 0:s.toString())!=null?i:"Ok",(c=(o=t==null?void 0:t.cancelLabel)==null?void 0:o.toString())!=null?c:"Cancel"]}})}const g=class g{constructor(e,t,a,s){r(this,"Xpos");r(this,"Ypos");r(this,"id");r(this,"type");r(this,"idImage");this.Xpos=e,this.Ypos=t,this.id=g.counter,this.idImage=s,this.type=a,g.counter++}getXpos(){return this.Xpos}getYpos(){return this.Ypos}getType(){return this.type}getId(){return this.id}getImageId(){return this.idImage}getRadius(){return 5}getColor(){return this.type===0?"rgb(255,0,0)":"rgb(250,218,94)"}toJSON(){return{id:this.getId(),Xpos:this.getXpos(),Ypos:this.getYpos(),type:this.getType()}}};r(g,"counter",0);let u=g;class J{constructor(e=[]){r(this,"nuclei");this.nuclei=e}append(e){this.nuclei.push(e)}remove(e){const t=this.nuclei.indexOf(e);if(t!==-1)this.nuclei.splice(t,1);else throw new Error("No matching nucleus to delete")}reset(){this.nuclei=[]}getNucleiInCount(){return this.nuclei.filter(e=>e.getType()===0).length}getNucleiOutCount(){return this.nuclei.filter(e=>e.getType()===1).length}getRatio(){return this.getNucleiInCount()/this.getTotalNucleiCount()}getTotalNucleiCount(){return this.getNucleiInCount()+this.getNucleiOutCount()}[Symbol.iterator](){return this.nuclei.values()}getLength(){return this.nuclei.length}toJSON(){const e={nuclei:[]};return this.nuclei.forEach(t=>{e.nuclei.push(t.toJSON())}),e}}const f=class f{constructor(e,t,a,s){r(this,"id");r(this,"position",[]);r(this,"idImage");r(this,"area");r(this,"ratio");this.id=f.counter,this.idImage=t,this.area=a,this.ratio=s,this.position=e,f.counter++}getPosition(){return this.position}getidImage(){return this.idImage}getArea(){return this.area}getRatio(){return this.ratio}toJSON(){return{area:this.area,fiberPath:this.position,id:this.id}}};r(f,"counter",0);let E=f;class q{constructor(){r(this,"ratio");r(this,"fibers");this.ratio=0,this.fibers=[]}append(e){this.fibers.push(e)}remove(e){const t=this.fibers.indexOf(e);if(t!==-1)this.fibers.splice(t,1);else throw new Error("No matching fiber to delete")}reset(){this.fibers=[],this.ratio=0}[Symbol.iterator](){return this.fibers[Symbol.iterator]()}getLength(){return this.fibers.length}getArea(){let e=0;return this.fibers.forEach(t=>{e+=t.getArea()}),e}getRatio(){let e=0;return this.fibers.forEach(t=>{e+=t.getRatio()}),e}toJSON(){const e={fibers:[]};return this.fibers.forEach(t=>{e.fibers.push(t.toJSON())}),e}}const y=class y{constructor(e,t,a){r(this,"canvas");r(this,"ctx");r(this,"nuclei");r(this,"fibers");r(this,"image");r(this,"imageColors");r(this,"transform");r(this,"showingNuclei");r(this,"showingFibers");r(this,"idImage");this.canvas=e,this.ctx=e.getContext("2d"),this.nuclei=new J,this.fibers=new q,this.idImage=a,this.image=t,this.transform={pos:{x:0,y:0},scale:1,m:[1,0,0,1,0,0],im:[1,0,0,1,0,0],isDragging:!1,lastX:0,lastY:0},this.imageColors={isRedRemoved:!1,isGreenRemoved:!1,isBlueRemoved:!1},this.showingNuclei=!0,this.showingFibers=!0,this.fitToScale()}drawImageWithMarkers(){this.clearCanvas(),this.clampOffsetPan();const e=this.transform.m;if(this.ctx.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]),this.ctx.drawImage(this.image,0,0),this.modifyColorOfImage(),this.showingNuclei)for(const t of this.nuclei)this.drawCircle(t.getXpos(),t.getYpos(),t.getRadius(),t.getColor());if(this.showingFibers)for(const t of this.fibers)this.drawFiber(t);this.restoreCanvas()}clearCanvas(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}showNuclei(e){this.showingNuclei=e}showFibers(e){this.showingFibers=e}updateChannels(e,t,a){this.imageColors.isBlueRemoved=!a,this.imageColors.isGreenRemoved=!t,this.imageColors.isRedRemoved=!e}addMarker(e,t,a){const s=new u(e,t,a,this.idImage);this.nuclei.append(s),this.drawImageWithMarkers(),this.fireEvent()}addFiber(e,t){const a=t/(this.image.width*this.image.height),s=new E(e,this.idImage,t,a);this.fibers.append(s),this.drawImageWithMarkers(),this.fireEvent()}addAllMarkers(e){for(const t of e.nucleiIn)this.nuclei.append(new u(t[0],t[1],0,this.idImage));for(const t of e.nucleiOut)this.nuclei.append(new u(t[0],t[1],1,this.idImage));this.drawImageWithMarkers(),this.fireEvent()}addAllFibers(e){for(const t in e){const a=e[t],s=a.fiberArea/(this.image.width*this.image.height),i=new E(a.fiberPath,this.idImage,a.fiberArea,s);this.fibers.append(i)}this.drawImageWithMarkers(),this.fireEvent()}fireEvent(){const e={positive:this.nuclei.getNucleiInCount(),total:this.nuclei.getTotalNucleiCount(),ratio:this.nuclei.getRatio(),fiberRatio:this.fibers.getRatio()},t=new CustomEvent("markerAdded",{detail:e});this.canvas.dispatchEvent(t)}getNuclei(){return this.nuclei.toJSON()}getFibers(){return this.fibers.toJSON()}mouseDownHandler(e){e.button===1&&(this.transform.isDragging=!0,this.transform.lastX=e.clientX,this.transform.lastY=e.clientY)}mouseMoveHandler(e){if(this.transform.isDragging){const t=e.clientX-this.transform.lastX,a=e.clientY-this.transform.lastY;this.transform.lastX=e.clientX,this.transform.lastY=e.clientY,this.transform.pos.x+=t,this.transform.pos.y+=a,this.updateMatrices(),this.drawImageWithMarkers()}}mouseUpHandler(e){console.log(e),this.transform.isDragging=!1}mouseWheelHandler(e){e.preventDefault();const t=this.transform.pos,a=-e.deltaY*.01,s=Math.exp(a*y.zoomExponent),i=Math.min(Math.max(.1,this.transform.scale*s),5),o=this.canvas.getBoundingClientRect(),c=e.clientX-o.left,l=e.clientY-o.top;t.x=c-(c-t.x)*(i/this.transform.scale),t.y=l-(l-t.y)*(i/this.transform.scale),this.transform.scale=i,this.updateMatrices(),this.drawImageWithMarkers()}mouseClickHandler(e){e.preventDefault();const t=this.canvas.getBoundingClientRect(),a=this.canvas.width/t.width,s=this.canvas.height/t.height,i=(e.clientX-t.left)*a,o=(e.clientY-t.top)*s,c=this.toWorld(i,o);e.button===0?this.addMarker(c.x,c.y,e.button):e.button===2&&this.addMarker(c.x,c.y,e.button)}clampOffsetPan(){const e=this.canvas.width,t=this.canvas.height,a=this.image.width*this.transform.scale,s=this.image.height*this.transform.scale,i=Math.max(0,e-a),o=Math.max(0,t-s),c=Math.min(0,e-a),l=Math.min(0,t-s);this.transform.pos.x=Math.max(c,Math.min(this.transform.pos.x,i)),this.transform.pos.y=Math.max(l,Math.min(this.transform.pos.y,o)),a<e&&(this.transform.pos.x=(e-a)/2),s<t&&(this.transform.pos.y=(t-s)/2),this.updateMatrices()}fitToScale(){const e=this.canvas.width/this.image.width,t=this.canvas.height/this.image.height;this.transform.scale=Math.min(e,t),this.updateMatrices()}updateMatrices(){const e=this.transform.m,t=this.transform.im,a=this.transform.scale,s=this.transform.pos;e[3]=e[0]=a,e[1]=e[2]=0,e[4]=s.x,e[5]=s.y,t[0]=t[3]=1/a,t[1]=t[2]=0,t[4]=-s.x/a,t[5]=-s.y/a}restoreCanvas(){this.ctx.restore(),this.ctx.setTransform(1,0,0,1,0,0)}drawCircle(e,t,a,s){this.ctx.beginPath(),this.ctx.arc(e,t,a,0,2*Math.PI,!1),this.ctx.fillStyle=s,this.ctx.fill()}drawFiber(e){const t=e.getPosition();this.ctx.strokeStyle="magenta",this.ctx.fillStyle="rgba(255, 182, 193, 0.5)",this.ctx.beginPath(),this.ctx.moveTo(t[0][0],t[0][1]);for(var a=1;a<t.length;a++)this.ctx.lineTo(t[a][0],t[a][1]);this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}toWorld(e,t){const a=this.transform.m,s=this.transform.im,i={x:0,y:0};return i.x=e-a[4],i.y=t-a[5],i.x=i.x*s[0]+i.y*s[2],i.y=i.x*s[1]+i.y*s[3],i}modifyColorOfImage(){const e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),t=e.data;for(let a=0;a<t.length;a+=4)this.imageColors.isRedRemoved&&(t[a]=0),this.imageColors.isGreenRemoved&&(t[a+1]=0),this.imageColors.isBlueRemoved&&(t[a+2]=0);this.ctx.putImageData(e,0,0)}};r(y,"zoomExponent",.05);let L=y;const h=class h{constructor(e,t){r(this,"id");r(this,"canvasElement");r(this,"cardElement");this.id=h.counter,this.canvasElement=new U(e,h.counter),this.cardElement=new _(t,h.counter),this.canvasToCardInteraction(),h.counter++}canvasToCardInteraction(){this.canvasElement.getHtmlCanvas().addEventListener("markerAdded",e=>{const a=e.detail;console.log(a),this.cardElement.changeHtmlCard(a.ratio,a.fiberRatio,a.positive,a.total)})}getId(){return`${this.id}`}toJSON(){return{FiberData:this.canvasElement.canvasTransform.getFibers().fibers,NucleiData:this.canvasElement.canvasTransform.getNuclei().nuclei}}};r(h,"counter",0);let w=h;class U{constructor(e,t){r(this,"htmlCanvas");r(this,"id");r(this,"img");r(this,"canvasTransform");this.id=t,this.img=e,this.htmlCanvas=this.createHTMLCanvas(),this.canvasTransform=new L(this.htmlCanvas,e,t)}getHTMLImage(){return this.img}createHTMLCanvas(){const e=document.getElementById("canvas_container"),t=document.createElement("canvas");return t.id=`canvas:${this.id}`,t.width=e.clientWidth,t.height=e.clientHeight,e.appendChild(t),t}getHtmlCanvas(){return this.htmlCanvas}deleteHTMLCanvas(){document.getElementById(`canvas:${this.id}`).remove()}toJSON(){return{FiberData:this.canvasTransform.getFibers().fibers,NucleiData:this.canvasTransform.getNuclei().nuclei}}}class _{constructor(e,t){r(this,"name");r(this,"ratio");r(this,"fibreArea");r(this,"positive");r(this,"total");r(this,"id");r(this,"card");this.name=e,this.ratio="N/A",this.fibreArea=0,this.positive=0,this.total=0,this.id=t,this.card=this.createHtmlCard()}createHtmlCard(){const e=document.getElementById("card-container"),t=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),i=this.createCardInfoItem("Total",`${this.total}`,"total"),o=this.createCardInfoItem("Positive",`${this.positive}`,"positive"),c=this.createCardInfoItem("Ratio",`${this.ratio}`,"ratio"),l=this.createCardInfoItem("Fiber Area",`${this.fibreArea}`,"area"),d=document.createElement("input"),m=document.createElement("button");return t.id=`card:${this.id}`,t.className="card",a.className="card-title",s.className="card-info",d.type="checkbox",d.className="card-checkbox",m.className="delete-button",a.textContent=`${this.name}`,m.textContent="X",t.appendChild(a),s.appendChild(i),s.appendChild(o),s.appendChild(c),s.appendChild(l),t.appendChild(s),t.appendChild(d),t.appendChild(m),e.appendChild(t),t}createCardInfoItem(e,t,a){const s=document.createElement("div"),i=document.createElement("label"),o=document.createElement("span");return s.id=a,i.textContent=e,o.textContent=t,s.className="card-info-item",s.appendChild(i),s.appendChild(o),s}getHtmlCard(){return this.card}deleteHtmlCard(){document.getElementById(`card:${this.id}`).remove()}getName(){return this.name}getRatio(){return this.ratio}getFibreArea(){return this.ratio}getPositive(){return`${this.positive}`}getTotal(){return`${this.total}`}changeHtmlCard(e,t,a,s){var I,x,k,M;this.total=s,this.fibreArea=t,this.positive=a,this.ratio=e>0?`${e}`:"NA";const o=document.getElementById("card-container").querySelector(`#card\\:${this.id}`);if(console.log(o),!o)return;const c=(I=o.querySelector("#total"))==null?void 0:I.querySelector("span"),l=(x=o.querySelector("#positive"))==null?void 0:x.querySelector("span"),d=(k=o.querySelector("#ratio"))==null?void 0:k.querySelector("span"),m=(M=o.querySelector("#area"))==null?void 0:M.querySelector("span");c&&l&&d&&m&&(c.textContent=s.toString(),l.textContent=a.toString(),d.textContent=`${e}`,m.textContent=`${t}`)}toJSON(){return{}}}class A{constructor(){r(this,"mappedLayers");r(this,"activeLayer");r(this,"checkboxedlayers");r(this,"mouseClickHandler",e=>{this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.mouseClickHandler(e)});r(this,"mouseWheelHandler",e=>{this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.mouseWheelHandler(e)});r(this,"mouseUpHandler",e=>{this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.mouseUpHandler(e)});r(this,"mouseMoveHandler",e=>{this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.mouseMoveHandler(e)});r(this,"mouseDownHandler",e=>{this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.mouseDownHandler(e)});r(this,"onChannelCheckboxChange",e=>{this.mappedLayers.forEach(t=>{t.canvasElement.canvasTransform.updateChannels(e.red,e.green,e.blue)}),this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.drawImageWithMarkers()});this.mappedLayers=new Map,this.checkboxedlayers=new Set,this.activeLayer=void 0,this.selectAllCardsEventListener(),this.deleteCheckedCardsEventListener(),this.initializeWrapperEventListeners(),this.channelEventListeners(),this.indicatorsEventListeners()}selectAllCardsEventListener(){const e=document.getElementById("selectAllCheckbox");e.addEventListener("click",()=>{this.mappedLayers.forEach(t=>{const a=t.cardElement.getHtmlCard().querySelector(".card-checkbox");e.checked?(a.checked=!0,this.checkboxedlayers.add(t)):(a.checked=!1,this.checkboxedlayers.delete(t))})})}deleteCheckedCardsEventListener(){document.getElementById("removeAllButton").addEventListener("click",()=>{this.checkboxedlayers.forEach(t=>{t.canvasElement.deleteHTMLCanvas(),t.cardElement.deleteHtmlCard(),this.mappedLayers.delete(t.getId())}),this.checkboxedlayers.clear()})}initializeWrapperEventListeners(){const e=document.getElementById("canvas_container");e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mousemove",this.mouseMoveHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("mouseleave",this.mouseUpHandler),e.addEventListener("wheel",this.mouseWheelHandler),e.addEventListener("click",this.mouseClickHandler),e.addEventListener("contextmenu",this.mouseClickHandler)}channelEventListeners(){const e=document.getElementById("blueCheckbox"),t=document.getElementById("greenCheckbox"),a=document.getElementById("redCheckbox"),s={red:!0,green:!0,blue:!0};a.checked=s.red,t.checked=s.green,e.checked=s.blue,e.addEventListener("change",()=>{s.blue=e.checked,this.onChannelCheckboxChange(s)}),t.addEventListener("change",()=>{s.green=t.checked,this.onChannelCheckboxChange(s)}),a.addEventListener("change",()=>{s.red=a.checked,this.onChannelCheckboxChange(s)})}indicatorsEventListeners(){const e=document.getElementById("nucleiCheckbox"),t=document.getElementById("fibersCheckbox");e.checked=!0,t.checked=!0,e.addEventListener("change",()=>{this.mappedLayers.forEach(a=>{a.canvasElement.canvasTransform.showNuclei(e.checked),this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.drawImageWithMarkers()})}),t.addEventListener("change",()=>{this.mappedLayers.forEach(a=>{a.canvasElement.canvasTransform.showFibers(t.checked),this.activeLayer&&this.activeLayer.canvasElement.canvasTransform.drawImageWithMarkers()})})}async addCard(e,t){return new Promise((a,s)=>{const i=new Image;i.src=t,i.addEventListener("load",()=>{const o=new w(i,e);this.mappedLayers.size===0&&(this.activeLayer=o,this.activeLayer.canvasElement.canvasTransform.drawImageWithMarkers()),this.mappedLayers.set(o.getId(),o),this.initialiseDeleteCardEventListener(o),this.initialiseCheckingBoxEventListener(o),this.initialiseSelectCardEventListener(o),a(o)}),i.addEventListener("error",o=>{s(o)})})}initialiseDeleteCardEventListener(e){e.cardElement.getHtmlCard().querySelector(".delete-button").addEventListener("click",a=>{a.stopPropagation(),window.confirm("Are you sure you want to delete this entry?")&&(e.cardElement.deleteHtmlCard(),e.canvasElement.deleteHTMLCanvas(),this.mappedLayers.delete(e.getId()),this.checkboxedlayers.delete(e))})}initialiseCheckingBoxEventListener(e){const t=e.cardElement.getHtmlCard().querySelector(".card-checkbox");t.addEventListener("click",a=>{a.stopPropagation(),t.checked?this.checkboxedlayers.add(e):this.checkboxedlayers.delete(e)})}initialiseSelectCardEventListener(e){const t=e.cardElement.getHtmlCard();t.addEventListener("click",()=>{this.activeLayer&&(this.activeLayer.cardElement.getHtmlCard().classList.remove("active"),this.activeLayer.canvasElement.canvasTransform.clearCanvas()),t.classList.add("active"),this.activeLayer=e,this.activeLayer.canvasElement.canvasTransform.drawImageWithMarkers()})}drawProcessesFiles(e){for(const t in e){const a=this.mappedLayers.get(t);a&&(a.canvasElement.canvasTransform.addAllMarkers(e[t].nuclei),a.canvasElement.canvasTransform.addAllFibers(e[t].fibers))}}getProcessingFiles(){const e={};return this.checkboxedlayers.forEach(t=>{const s=t.canvasElement.getHTMLImage().src;e[t.getId()]=s}),e}getSavingData(){const e={title:"",data:{}};return this.mappedLayers.forEach(t=>{const s=t.canvasElement.getHTMLImage().src;e.data[`${t.getId()}`]={nameImage:t.cardElement.getName(),dataUrlBase64:s,FiberData:t.canvasElement.canvasTransform.getFibers().fibers,NucleiData:t.canvasElement.canvasTransform.getNuclei().nuclei}}),e}getCSV(){var e=[["Image names","Total number of nuclei","Number of tropomyosin positive nuclei","Fusion index","Fiber area ratio"]];this.mappedLayers.forEach(a=>{e.push([a.cardElement.getName(),a.cardElement.getTotal(),a.cardElement.getPositive(),a.cardElement.getRatio(),a.cardElement.getFibreArea()])});let t="";return e.forEach((a,s)=>{const i=a.join(";");t+=s<e.length?i+`
`:i}),t}async loadProject(e){for(const t in e){const a=e[t],s=await this.addCard(a.nameImage,a.dataUrlBase64);this.loadingMarkers(s,a.NucleiData),this.loadingFibers(s,a.FiberData)}}loadingMarkers(e,t){for(const a of t)e.canvasElement.canvasTransform.addMarker(a.Xpos,a.Ypos,a.type)}loadingFibers(e,t){for(const a of t)e.canvasElement.canvasTransform.addFiber(a.fiberPath,a.area)}}const v=new A;window.addEventListener("contextmenu",n=>n.preventDefault());const T=new FileReader,D=document.getElementById("loadImagesButton");D.addEventListener("change",()=>{const n=D.files;if(!(n===null||n.length===0))for(const e of n)T.readAsDataURL(e),T.addEventListener("load",t=>{if(!t.target)return;const a=t.target.result;v.addCard(e.name,a)})});const z=document.getElementById("processImagesButton");z.addEventListener("click",async()=>{const n=v.getProcessingFiles(),e=JSON.stringify(n);if(e.startsWith("{}"))return;const t=await p("send_and_receive",{input:e}),a=JSON.parse(t);v.drawProcessesFiles(a)});const V=document.getElementById("saveAsButton");V.addEventListener("click",async()=>{const n=await H();if(!n)return;const e=n.split("/"),t=e[e.length-1],a=v.getSavingData();a.title=t,console.log(a),console.log(n),await p("save",{projectPath:n,csvData:v.getCSV(),data:a})});const G=document.getElementById("loadProjectButton");G.addEventListener("click",async()=>{const n=await N({directory:!0,multiple:!1});if(!n)return;const e=n.split("/"),t=e[e.length-1],a=n+"/"+t+".bin",s=await p("load",{fullPath:a}),i=new Int8Array(s).buffer;if(s.length===0){await B("No .bin file found in the directory.");return}const c=new TextDecoder().decode(i),l=JSON.parse(c);new A().loadProject(l.data)});
